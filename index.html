<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>2D Town Simulation Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style>
      body {
        margin: 0;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <script>
      const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
          default: 'arcade',
          arcade: {
            gravity: { y: 0 },
            debug: false
          }
        },
        scene: {
          preload: preload,
          create: create,
          update: update
        }
      };

      const game = new Phaser.Game(config);

      let npcs = [];
      let world;

      function preload() {
        this.load.image('npc', 'path/to/npc.png');
        this.load.image('house', 'path/to/house.png');
        this.load.image('farm', 'path/to/farm.png');
      }

      function create() {
        world = createWorldGrid(10, 10);
        createNPCs(10, this);
        createBuildings(this);
      }

      function update() {
        npcs.forEach(npc => {
          npc.updateBehavior();
        });
      }

      function createWorldGrid(rows, cols) {
        let grid = [];
        for (let row = 0; row < rows; row++) {
          let newRow = [];
          for (let col = 0; col < cols; col++) {
            newRow.push({ x: col * 64, y: row * 64, type: 'grass' });
          }
          grid.push(newRow);
        }
        return grid;
      }

      class NPC {
        constructor(scene, x, y, name, personality, job) {
          this.sprite = scene.physics.add.sprite(x, y, 'npc');
          this.name = name;
          this.personality = personality;
          this.job = job;
          this.needs = {
            hunger: 100,
            thirst: 100,
            social: 50 // New need for social interaction
          };
          this.relationships = {
            friends: [],
            enemies: [],
            spouse: null,
            children: []
          };
        }

        updateBehavior() {
          this.updateNeeds();
          this.makeDecisions();
        }

        updateNeeds() {
          this.needs.hunger -= 0.1;
          this.needs.thirst -= 0.1;
          this.needs.social -= 0.05; // Social need decreases slowly

          if (this.needs.hunger < 20) {
            this.eat();
          }
          if (this.needs.thirst < 20) {
            this.drink();
          }
          if (this.needs.social < 30) {
            this.seekSocialInteraction();
          }
        }

        makeDecisions() {
          if (this.job) {
            this.performJob();
          }

          // Randomly decide to interact with nearby NPCs
          if (Phaser.Math.Between(0, 100) < 10) {
            this.interactWith(this.findNearbyNPC());
          }
        }

        performJob() {
          switch (this.job) {
            case 'farmer':
              this.farm();
              break;
            case 'builder':
              this.build();
              break;
            case 'trader':
              this.trade();
              break;
            // Add more jobs as needed
          }
        }

        farm() {
          // Farming logic (e.g., grow food for town)
          console.log(`${this.name} is farming.`);
        }

        build() {
          // Building logic (e.g., build structures for town)
          console.log(`${this.name} is building.`);
        }

        trade() {
          // Trading logic (e.g., exchange goods with other NPCs)
          console.log(`${this.name} is trading.`);
        }

        seekSocialInteraction() {
          const nearbyNPC = this.findNearbyNPC();
          if (nearbyNPC) {
            this.interactWith(nearbyNPC);
          }
        }

        interactWith(npc) {
          if (!npc) return;

          // Basic interaction logic
          console.log(`${this.name} is interacting with ${npc.name}.`);

          // Determine relationship effects based on personalities
          const isFriendly = Phaser.Math.Between(0, 100) > 50;
          if (isFriendly) {
            this.formFriendship(npc);
          } else {
            this.formRivalry(npc);
          }
        }

        formFriendship(npc) {
          console.log(`${this.name} and ${npc.name} have become friends.`);
          this.relationships.friends.push(npc);
          npc.relationships.friends.push(this);
        }

        formRivalry(npc) {
          console.log(`${this.name} and ${npc.name} are now rivals.`);
          this.relationships.enemies.push(npc);
          npc.relationships.enemies.push(this);
        }

        eat() {
          this.needs.hunger += 20;
          console.log(`${this.name} is eating.`);
        }

        drink() {
          this.needs.thirst += 20;
          console.log(`${this.name} is drinking.`);
        }

        findNearbyNPC() {
          // Simple logic to find a random nearby NPC
          if (npcs.length > 1) {
            const randomNPC = npcs[Phaser.Math.Between(0, npcs.length - 1)];
            return randomNPC !== this ? randomNPC : null;
          }
          return null;
        }
      }

      function createNPCs(numNPCs, scene) {
        const jobs = ['farmer', 'builder', 'trader'];
        for (let i = 0; i < numNPCs; i++) {
          let x = Phaser.Math.Between(0, 800);
          let y = Phaser.Math.Between(0, 600);
          let name = 'NPC ' + i;
          let personality = Phaser.Math.Between(1, 3); // Placeholder for random personalities
          let job = jobs[Phaser.Math.Between(0, jobs.length - 1)];
          let npc = new NPC(scene, x, y, name, personality, job);
          npcs.push(npc);
        }
      }

      function createBuildings(scene) {
        scene.add.sprite(100, 100, 'house');
        scene.add.sprite(200, 200, 'farm');
      }

    </script>
  </body>
</html>
